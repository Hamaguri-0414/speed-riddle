# Speed-Riddle実装計画書

## 概要
SPEC.mdに基づいて、謎解きスピード競争サイト「speed-riddle」の実装を段階的に行います。
機能の優先度と依存関係を考慮し、1PR単位で実装を進めます。

## 全体の実装見積もり
**合計PR数: 12PR**

実装期間目安: 約6-8週間（1PR当たり3-5日）

## 実装計画（PR単位）

### Phase 1: プロジェクト基盤構築（3PR）

#### PR #1: プロジェクトセットアップ
- **目標**: Next.js 14プロジェクトの初期化と基本設定
- **作業内容**:
  - Next.js 14 (App Router) + TypeScriptプロジェクトの作成
  - Tailwind CSS + shadcn/uiのセットアップ
  - 基本的な開発環境の構築（ESLint, Prettier, Husky）
  - パッケージマネージャー（pnpm）の設定
- **成果物**:
  - 基本的なNext.jsアプリケーション
  - 開発環境設定ファイル
  - 基本的なレイアウトコンポーネント

#### PR #2: データベース設計と環境設定
- **目標**: データベーススキーマの設定とPrisma ORM導入
- **作業内容**:
  - PostgreSQL + Prisma ORMの設定
  - データモデルの実装（Puzzle, Question, Answer, Session, SegmentTime, Ranking）
  - 環境変数の設定（.env.example作成）
  - 初期マイグレーションの作成
- **成果物**:
  - prisma/schema.prisma
  - データベースマイグレーションファイル
  - 型定義ファイル

#### PR #3: 認証・状態管理システム
- **目標**: セッション管理とグローバル状態管理の実装
- **作業内容**:
  - NextAuth.jsを使った匿名認証システム
  - Zustandを使った状態管理の設定
  - セッション管理のためのミドルウェア実装
- **成果物**:
  - 認証設定ファイル
  - 状態管理ストア
  - セッション管理ミドルウェア

### Phase 2: 謎解きチャレンジ機能（5PR）

#### PR #4: 謎解き一覧画面
- **目標**: メイン画面となる謎解き一覧の実装
- **作業内容**:
  - 謎解き一覧画面UI実装
  - 謎解き一覧取得APIの実装
  - サムネイル表示機能
  - レスポンシブデザイン対応
- **成果物**:
  - 謎解き一覧画面（/app/page.tsx）
  - 謎解き一覧取得API（/api/puzzles）
  - 謎解きカードコンポーネント

#### PR #5: 謎解き開始前画面
- **目標**: 謎解き詳細表示と開始準備画面
- **作業内容**:
  - 謎解き詳細画面UI実装
  - 謎解き詳細取得APIの実装
  - 謎解き開始準備機能
- **成果物**:
  - 謎解き詳細画面（/app/puzzles/[id]/page.tsx）
  - 謎解き詳細取得API（/api/puzzles/[id]）

#### PR #6: 謎解き画面の基本実装
- **目標**: 謎解き画面のUI実装とタイマー機能
- **作業内容**:
  - 謎解き画面UI実装
  - タイマー機能の実装
  - 問題表示機能
  - 解答入力フォーム
- **成果物**:
  - 謎解き画面（/app/puzzles/[id]/solve/page.tsx）
  - タイマーコンポーネント
  - 問題表示コンポーネント
  - 解答入力コンポーネント

#### PR #7: 謎解き解答システム
- **目標**: 解答送信・判定機能の実装
- **作業内容**:
  - セッション開始API実装
  - 解答送信・判定API実装
  - 解答形式バリデーション
  - セグメントタイム記録機能
- **成果物**:
  - セッション開始API（/api/puzzles/[id]/start）
  - 解答送信API（/api/puzzles/[id]/answer）
  - 解答判定ロジック

#### PR #8: リザルト画面とランキング機能
- **目標**: リザルト表示とランキング機能の実装
- **作業内容**:
  - リザルト画面UI実装
  - ランキング画面UI実装
  - ランキング取得API実装
  - セッション完了API実装
- **成果物**:
  - リザルト画面（/app/puzzles/[id]/result/page.tsx）
  - ランキング画面（/app/puzzles/[id]/ranking/page.tsx）
  - ランキング取得API（/api/puzzles/[id]/ranking）
  - セッション完了API（/api/puzzles/[id]/complete）

### Phase 3: 謎解き出題機能（3PR）

#### PR #9: 謎解き出題画面の基本実装
- **目標**: 謎解き作成フォームの実装
- **作業内容**:
  - 謎解き出題画面UI実装
  - 基本情報入力フォーム（タイトル、説明、サムネイル）
  - フォームバリデーション
- **成果物**:
  - 謎解き出題画面（/app/puzzles/create/page.tsx）
  - 謎解き作成フォームコンポーネント

#### PR #10: 問題・解答設定機能
- **目標**: 動的な問題・解答設定機能の実装
- **作業内容**:
  - 問題追加・削除機能
  - 画像アップロード機能
  - 解答設定機能（複数解答対応）
  - 解答形式設定機能
- **成果物**:
  - 問題設定コンポーネント
  - 画像アップロード機能
  - 解答設定コンポーネント

#### PR #11: 謎解き投稿機能
- **目標**: 謎解き投稿APIとデータ保存機能
- **作業内容**:
  - 謎解き投稿API実装
  - 画像アップロード処理
  - データベース保存処理
  - 投稿後の画面遷移
- **成果物**:
  - 謎解き投稿API（/api/puzzles POST）
  - 画像アップロード処理
  - データ保存ロジック

### Phase 4: 最終調整と最適化（1PR）

#### PR #12: パフォーマンス最適化とテスト
- **目標**: パフォーマンス最適化とテストの実装
- **作業内容**:
  - 画像最適化の実装
  - キャッシュ機能の実装
  - 基本的なテストの追加
  - セキュリティ対策の実装
  - エラーハンドリングの改善
- **成果物**:
  - 最適化されたアプリケーション
  - テストファイル
  - セキュリティ対策コード

## 技術的考慮事項

### 開発順序の理由
1. **基盤→機能**: インフラとデータベースを先に構築
2. **チャレンジ→出題**: ユーザー体験の流れに沿って実装
3. **UI→API**: 画面設計を先に行い、APIは後から実装
4. **コア機能→最適化**: 基本機能を優先し、最適化は最後

### 各PRの独立性
- 各PRは独立してテスト・デプロイ可能
- ダウンタイムを最小限に抑える段階的リリース
- 問題発生時の切り戻しが容易

### リスク管理
- 複雑な機能（タイマー、画像アップロード）は早期に実装
- 依存関係の少ない機能から開始
- 各段階でのテストを重視

## 成果物チェックリスト

### 各PR完了時の確認事項
- [ ] コードレビュー完了
- [ ] テスト実行（該当する場合）
- [ ] 型チェック完了
- [ ] リント完了
- [ ] 動作確認完了
- [ ] ドキュメント更新（該当する場合）

### 最終成果物
- [ ] 謎解き一覧・詳細・解答画面
- [ ] 謎解き出題機能
- [ ] ランキング機能
- [ ] レスポンシブデザイン
- [ ] 基本的なテスト
- [ ] セキュリティ対策
- [ ] パフォーマンス最適化

この計画により、段階的かつ確実に要件を満たすアプリケーションを構築できます。